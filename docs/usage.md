# Использование журнала загрузок ytd

## Зачем нужен журнал

Журнал позволяет видеть историю всех загрузок: статус (успех/ошибка), путь до файла, дату завершения и номер плейлиста. Данные хранятся в SQLite (`history_db`), а исходные метаданные остаются в JSONL (`save_metadata`).

- `ytd history` — список последних событий с фильтрами `--status`, `--limit`, `--since`, `--playlist`
- `ytd history show <ID>` — подробная карточка по конкретному видео (можно передать URL с параметром `v=`)
- `ytd history export --format jsonl|csv` — экспорт в stdout (можно перенаправить в файл)

Если вы использовали JSONL метаданные раньше, при первом создании базы история подтянется автоматически: достаточно оставить файл `save_metadata` на месте и запустить любую команду, которая инициализирует БД (например, `ytd history`).

## Настройка

Все параметры задаются в `config.yaml` или через переменные окружения:

| Опция | По умолчанию | Переменная окружения | Назначение |
| --- | --- | --- | --- |
| `history_enabled` | `true` | `YTD_HISTORY_ENABLED` | Включает или отключает журнал полностью |
| `history_db` | `data/history.db` | `YTD_HISTORY_DB` | Путь к SQLite-файлу истории |
| `save_metadata` | `data/meta.jsonl` | `YTD_SAVE_METADATA` | JSONL-файл с метаданными; используется и для импорта |

Пример блока в конфиге:

```yaml
history_enabled: true
history_db: ./data/history.db
save_metadata: ./data/meta.jsonl
```

## Советы

- При отключенном журнале (`history_enabled: false`) команда `ytd history` вернёт предупреждение, а загрузчик перестанет писать события.
- Директории для `history_db` и `save_metadata` создаются автоматически, можно указывать относительные пути.
- Для переноса истории на другой компьютер скопируйте `history.db` и соответствующий `meta.jsonl` — при первой инициализации таблицы записи будут импортированы.
