# Intra-video pause control

Status: TODO (не реализовано)
Priority: низкий
Owner: @Ivan
Created: 2025-10-27

## Summary
Возможность поставить на паузу загрузку **внутри** одного видео (не между видео в плейлисте, а во время скачивания текущего файла).

## Requirements
- Пользователь нажимает клавишу паузы (например, `p`) во время загрузки файла
- Загрузка **останавливается** (не просто становится в очередь после завершения текущего чанка, а прерывается немедленно или на ближайшей возможности)
- При возобновлении (клавиша `r`) загрузка продолжается с того же места

## Technical challenges
- yt-dlp не предоставляет встроенный API для приостановки/возобновления загрузки в середине файла
- Прогресс-хук (`progress_hooks`) получает информацию о статусе, но не может напрямую остановить процесс
- Варианты реализации:
  1. **Прерывание процесса**: вызвать исключение в прогресс-хуке → отменить загрузку → при возобновлении скачивать с начала (или с частичного файла, если yt-dlp поддерживает resume)
  2. **Suspend/resume сетевого соединения**: технически сложно; нужно патчить низкоуровневые HTTP-обработчики yt-dlp или использовать внешний прокси с управлением
  3. **Использовать внешний downloader**: передать URL во внешний менеджер загрузок (aria2, wget), который поддерживает паузы нативно; но теряется интеграция с yt-dlp (форматы, мультиплексирование аудио+видео)

## Implementation notes
- Самый простой подход (вариант 1): по нажатию клавиши паузы установить флаг, в progress_hook вызвать `raise KeyboardInterrupt` (или пользовательское исключение), отловить его в вызывающем коде, показать промпт паузы, при возобновлении повторить запрос с теми же параметрами
  - Плюсы: легко реализовать
  - Минусы: не настоящая пауза, а отмена+рестарт; при больших файлах может быть неэффективно, если yt-dlp не поддерживает продолжение с частичного файла
- Для настоящей паузы потребуется:
  - Патчить yt-dlp или использовать внешний downloader с API управления
  - Сложная архитектура с IPC (например, запускать загрузку в отдельном процессе и управлять через сигналы/пайпы)

## Recommendation
- Оставить TODO до запроса от пользователей; текущая реализация (пауза **между** видео) покрывает большинство кейсов
- Если будет актуальна внутривидовая пауза — рассмотреть вариант с внешним downloader (aria2c) + конфигурируемым флагом `use_external_downloader` в yt-dlp

## References
- yt-dlp docs: [External downloaders](https://github.com/yt-dlp/yt-dlp#external-downloaders)
- aria2c: https://aria2.github.io/ (поддерживает паузу, возобновление, многопоточность)

---

**Статус**: отложено до явного запроса функциональности; межвидовая пауза (реализована) — приоритетнее.
